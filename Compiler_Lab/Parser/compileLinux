#!/bin/bash
clear
PROGRAM=`basename ${0}`
file_name="$PROGRAM.system"
input_file_name="input.txt"

clean(){
	echo -e "\n------------------------------------" 
	echo    ":::: Clean ::::" 
	echo -e "------------------------------------"
	rm -rf scannerRule.yy.obj;
	rm -rf AST.obj;
	rm -rf parserRule.tab.obj;
	rm -rf $file_name;
	rm -rf "c.system";
	echo -e "------------------------------------\n" 
}

compile(){
	echo -e "\n------------------------------------" 
	echo 	":::: Compile ::::" 
	echo -e "------------------------------------"

	flex -d --nounistd -oscannerRule.yy.cpp scannerRule.l
	bison -d -oparserRule.tab.cpp parserRule.y

	g++ -c scannerRule.yy.cpp -o scannerRule.yy.obj
	g++ -c AST.cpp -o AST.obj
	g++ -c parserRule.tab.cpp -o parserRule.tab.obj
	g++ -o $file_name compiler.cpp parserRule.tab.obj scannerRule.yy.obj AST.obj
	echo -e "------------------------------------\n" 
}

run(){
	echo -e "\n------------------------------------" 
	echo 	":::: RUN ::::"
	echo -e "file : "$file_name 
	echo -e "input file : "$input_file_name 
	echo -e "------------------------------------"
	echo "/****** Start RUN ******/"

	./$file_name $input_file_name

	echo "/****** End RUN ******/"
	echo -e "------------------------------------\n" 
	
}

while [ $# -gt 0 ]
do
    case "$1" in
    	-o)  
			file_name=$2; shift ;;
		-i)  
			input_file_name=$2; shift ;;
        clean)  
			clean ;;
        compile)  
			compile;;
        run)  
			run;;
 		*)  
	      echo "Unknown command: \`$1'"
	      echo "Usage: $PROGRAM ( commands ... )"
	      echo "commands:"
	      echo "	-o <file>		Place the output into <file>, default:$PROGRAM.system"
	      echo "	-i <file>		Place the input into <file>, default:input.txt"
	      echo "	clean			Attempts to clean the files and directories generated by $PROGRAM"
	      echo "	compiler		Attempts build new files"
	      echo "	run			are you running output file by pass input file into"
	      exit 1
	      ;; 
    esac
    shift
done



